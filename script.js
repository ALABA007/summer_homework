const poems = [
      {
        title: "Sonnet 18",
        text: `Shall I compare thee to a summer's day?
Thou art more lovely and more temperate:
Rough winds do shake the darling buds of May,
And summer's lease hath all too short a date:
Sometime too hot the eye of heaven shines,
And often is his gold complexion dimmed;
And every fair from fair sometime declines,
By chance, or nature's changing course, untrimmed;
But thy eternal summer shall not fade,
Nor lose possession of that fair thou ow'st,
Nor shall death brag thou wander'st in his shade,
When in eternal lines to time thou grow'st:
So long as men can breathe or eyes can see,
So long lives this, and this gives life to thee.`,
        author: "William Shakespeare",
        category: "english",
        analysis: `<analysis>
  <theme>Eternal beauty and the power of poetry</theme>
  <structure>Shakespearean sonnet with ABAB CDCD EFEF GG rhyme scheme</structure>
  <literary_devices>
    <metaphor>Comparing beloved to summer's day</metaphor>
    <personification>Death bragging, nature's changing course</personification>
    <imagery>Visual imagery of summer, sun, and natural beauty</imagery>
  </literary_devices>
  <interpretation>The speaker argues that poetry can immortalize beauty, transcending the temporal limitations of natural beauty. The final couplet emphasizes poetry's power to preserve beauty for eternity.</interpretation>
</analysis>`
      },
      {
        title: "Because I could not stop for Death",
        text: `Because I could not stop for Death â
He kindly stopped for me â
The Carriage held but just Ourselves â
And Immortality.

We slowly drove â He knew no haste
And I had put away
My labor and my leisure too,
For His Civility â

We passed the School, where Children strove
At Recess â in the Ring â
We passed the Fields of Gazing Grain â
We passed the Setting Sun â

Or rather â He passed us â
The Dews drew quivering and chill â
For only Gossamer, my Gown â
My Tippet â only Tulle â

We paused before a House that seemed
A Swelling of the Ground â
The Roof was scarcely visible â
The Cornice â in the Ground â

Since then â 'tis Centuries â and yet
Feels shorter than the Day
I first surmised the Horses' Heads
Were toward Eternity â`,
        author: "Emily Dickinson",
        category: "english",
        analysis: `<analysis>
  <theme>Death personified as a courteous gentleman; journey toward eternity</theme>
  <structure>Six quatrains with slant rhyme and irregular meter</structure>
  <literary_devices>
    <personification>Death as a kind carriage driver</personification>
    <allegory>Life's journey represented as a carriage ride</allegory>
    <symbolism>House representing grave, carriage representing life's passage</symbolism>
  </literary_devices>
  <interpretation>Dickinson presents death not as fearsome but as a civil companion. The poem explores the transition from life to death as a gentle journey, with the final stanza suggesting the eternal nature of the afterlife experience.</interpretation>
</analysis>`
      },
      {
        title: "The Road Not Taken",
        text: `Two roads diverged in a yellow wood,
And sorry I could not travel both
And be one traveler, long I stood
And looked down one as far as I could
To where it bent in the undergrowth;

Then took the other, as just as fair,
And having perhaps the better claim,
Because it was grassy and wanted wear;
Though as for that the passing there
Had worn them really about the same,

And both that morning equally lay
In leaves no step had trodden black.
Oh, I kept the first for another day!
Yet knowing how way leads on to way,
I doubted if I should ever be back.

I shall be telling this with a sigh
Somewhere ages and ages hence:
Two roads diverged in a wood, and Iâ
I took the one less traveled by,
And that has made all the difference.`,
        author: "Robert Frost",
        category: "english",
        analysis: `<analysis>
  <theme>Choice, regret, and the paths we take in life</theme>
  <structure>Four stanzas of five lines each with ABAAB rhyme scheme</structure>
  <literary_devices>
    <metaphor>Roads representing life choices</metaphor>
    <symbolism>Yellow wood representing autumn of life, decision point</symbolism>
    <irony>The speaker's future narrative may not reflect the actual equality of the paths</irony>
  </literary_devices>
  <interpretation>Often misread as celebrating nonconformity, the poem actually explores how we construct narratives about our choices. The speaker acknowledges both paths were "really about the same" but predicts he'll claim his choice made "all the difference."</interpretation>
</analysis>`
      },
      {
        title: "Ozymandias",
        text: `I met a traveller from an antique land,
Who saidâ"Two vast and trunkless legs of stone
Stand in the desert. . . . Near them, on the sand,
Half sunk a shattered visage lies, whose frown,
And wrinkled lip, and sneer of cold command,
Tell that its sculptor well those passions read
Which yet survive, stamped on these lifeless things,
The hand that mocked them, and the heart that fed;
And on the pedestal, these words appear:
My name is Ozymandias, King of Kings;
Look on my Works, ye Mighty, and despair!
Nothing beside remains. Round the decay
Of that colossal Wreck, boundless and bare
The lone and level sands stretch far away."`,
        author: "Percy Bysshe Shelley",
        category: "english",
        analysis: `<analysis>
  <theme>The transience of power and human pride</theme>
  <structure>Petrarchan sonnet with slight variation in rhyme scheme</structure>
  <literary_devices>
    <irony>The boastful inscription contrasts with the ruined state</irony>
    <imagery>Vivid description of the desert ruins</imagery>
    <alliteration>"boundless and bare," "lone and level"</alliteration>
  </literary_devices>
  <interpretation>Shelley uses the ruined statue to illustrate the inevitable decline of all earthly power. The poem serves as a meditation on hubris and the ultimate insignificance of human achievements in the face of time.</interpretation>
</analysis>`
      },
      {
        title: "Do not go gentle into that good night",
        text: `Do not go gentle into that good night,
Old age should burn and rave at close of day;
Rage, rage against the dying of the light.

Though wise men at their end know dark is right,
Because their words had forked no lightning they
Do not go gentle into that good night.

Good men, the last wave by, crying how bright
Their frail deeds might have danced in a green bay,
Rage, rage against the dying of the light.

Wild men who caught and sang the sun in flight,
And learn, too late, they grieved it on its way,
Do not go gentle into that good night.

Grave men, near death, who see with blinding sight
Blind eyes could blaze like meteors and be gay,
Rage, rage against the dying of the light.

And you, my father, there on the sad height,
Curse, bless, me now with your fierce tears, I pray.
Do not go gentle into that good night.
Rage, rage against the dying of the light.`,
        author: "Dylan Thomas",
        category: "english",
        analysis: `<analysis>
  <theme>Resistance to death, the struggle between life and mortality</theme>
  <structure>Villanelle with strict repetition pattern and ABA rhyme scheme</structure>
  <literary_devices>
    <metaphor>Night representing death, light representing life</metaphor>
    <repetition>Refrain lines emphasizing the central message</repetition>
    <alliteration>"good night," "dying of the light"</alliteration>
  </literary_devices>
  <interpretation>Written for his dying father, Thomas explores different types of men facing death. Despite knowing death is natural, he advocates for passionate resistance to mortality, celebrating the human spirit's refusal to surrender easily.</interpretation>
</analysis>`
      },
      {
        title: "éå¤æ",
        text: `åºåææåï¼
çæ¯å°ä¸éã
ä¸¾å¤´æææï¼
ä½å¤´ææä¹¡ã`,
        author: "æç½",
        category: "chinese",
        analysis: `<analysis>
  <theme>æä¹¡ä¹æï¼æ¸¸å­å¯¹æä¹¡çæ·±åæå¿µ</theme>
  <structure>äºè¨ç»å¥ï¼å¹³èµ·å¹³æ¶ï¼éµèä¸º"åãéãä¹¡"</structure>
  <literary_devices>
    <imagery>æåå¦éçè§è§æè±¡</imagery>
    <contrast>ä¸¾å¤´ä¸ä½å¤´çå¨ä½å¯¹æ¯</contrast>
    <symbolism>ææè±¡å¾æä¹¡ææ</symbolism>
  </literary_devices>
  <interpretation>è¯äººéè¿æåå¤æçå°æåçæåï¼è¡¨è¾¾äºèº«å¨å¼ä¹¡å¯¹æä¹¡çæ·±åæå¿µãå¨è¯è¯­è¨ç®æ´ï¼æå¢æ·±è¿ï¼ä½ç°äºæç½è¯æ­çæ¸æ°èªç¶é£æ ¼ãæåæ¢æ¯å¼åæä¹¡çåªä»ï¼ä¹æ¯è¿æ¥æä¹¡ççº½å¸¦ã</interpretation>
</analysis>`
      },
      {
        title: "æ¥æ",
        text: `æ¥ç ä¸è§æï¼
å¤å¤é»å¼é¸ã
å¤æ¥é£é¨å£°ï¼
è±è½ç¥å¤å°ã`,
        author: "å­æµ©ç¶",
        category: "chinese",
        analysis: `<analysis>
  <theme>æ¥æ¥æ¯è±¡ï¼å¯¹èªç¶çç»è»æå</theme>
  <structure>äºè¨ç»å¥ï¼è¯­è¨æ´ç´ èªç¶</structure>
  <literary_devices>
    <auditory_imagery>é¸å¼å£°ãé£é¨å£°çå¬è§æå</auditory_imagery>
    <questioning>è®¾é®å¥å¢å¼ºè¡¨è¾¾ææ</questioning>
    <contrast>ç¡ç çå®é¸ä¸èªç¶ççå¨åå</contrast>
  </literary_devices>
  <interpretation>è¯äººæç»äºæ¥æ¥æ¸æ¨çç¾å¥½æ¯è±¡ï¼éè¿å¬è§æåå±ç°æ¥å¤©ççæºååãæåä¸å¥ççé®è¡¨è¾¾äºå¯¹æ¥è±åé¶çæ·¡æ·¡ææï¼ä½ç°äºè¯äººå¯¹èªç¶çææåå¯¹æ¶åæµéçææ¨ã</interpretation>
</analysis>`
      },
      {
        title: "ç»é¹³éæ¥¼",
        text: `ç½æ¥ä¾å±±å°½ï¼
é»æ²³å¥æµ·æµã
æ¬²ç©·åéç®ï¼
æ´ä¸ä¸å±æ¥¼ã`,
        author: "çä¹æ¶£",
        category: "chinese",
        analysis: `<analysis>
  <theme>å²çæèï¼ç§¯æè¿åçäººçæåº¦</theme>
  <structure>äºè¨ç»å¥ï¼å¯¹ä»å·¥æ´ï¼å¯ææ·±å»</structure>
  <literary_devices>
    <visual_imagery>ç½æ¥ãé»æ²³çå£®ä¸½æ¯è±¡</visual_imagery>
    <metaphor>ç»æ¥¼å»æäººçè¿å</metaphor>
    <parallelism>åä¸¤å¥å¯¹ä»ææ¯ï¼åä¸¤å¥å¯¹ä»ææ</parallelism>
  </literary_devices>
  <interpretation>è¯äººéè¿æåç»æ¥¼æè§çå£®ä¸½æ¯è²ï¼éè¿°äº"è¦æ³çå¾æ´è¿ï¼å°±è¦ç«å¾æ´é«"çäººçå²çãå¨è¯èåæ¯ãææãè®®è®ºäºä¸ä½ï¼è¡¨è¾¾äºç§¯æåä¸çè¿åç²¾ç¥åå¼éçè¸æã</interpretation>
</analysis>`
      },
      {
        title: "ç¸æ",
        text: `çº¢è±çåå½ï¼
æ¥æ¥åå æã
æ¿åå¤éæ·ï¼
æ­¤ç©æç¸æã`,
        author: "çç»´",
        category: "chinese",
        analysis: `<analysis>
  <theme>ç¸æä¹æï¼å¯¹åäººçæ·±åæå¿µ</theme>
  <structure>äºè¨ç»å¥ï¼è¯­è¨å«èï¼ææ·±æé¿</structure>
  <literary_devices>
    <symbolism>çº¢è±è±¡å¾ç¸æä¹æ</symbolism>
    <personification>å¯¹çº¢è±çæäººåå¤ç</personification>
    <euphemism>å«èè¡¨è¾¾æå¿µä¹æ</euphemism>
  </literary_devices>
  <interpretation>è¯äººåçº¢è±è¿ä¸å·æè±¡å¾æä¹çäºç©ï¼è¡¨è¾¾äºå¯¹è¿æ¹åäººçæ·±åæå¿µãå¨è¯è¯­è¨æ´ç´ ï¼ä½ææçæï¼ä½ç°äºçç»´è¯æ­æ¸æ·¡å«èçèºæ¯ç¹è²ãçº¢è±æä¸ºææçè½½ä½åå¯æã</interpretation>
</analysis>`
      },

    ];

    let currentPoems = poems;
    let favorites = JSON.parse(localStorage.getItem('poetryFavorites')) || [];
    let currentPoemIndex = -1;
    let speechSynthesis = window.speechSynthesis;

    function renderPoems(poemsToRender = currentPoems) {
      const buttonList = document.getElementById('buttonList');
      buttonList.innerHTML = '';

      poemsToRender.forEach((poem, index) => {
        const button = document.createElement('button');
        button.className = 'poem-button';
        button.innerHTML = `
          <div class="poem-title">${poem.title}</div>
          <div class="poem-author">by ${poem.author}</div>
        `;
        button.onclick = () => displayPoem(poem, poems.indexOf(poem));
        buttonList.appendChild(button);
      });
    }

    function displayPoem(poem, index) {
      currentPoemIndex = index;
      const poemText = document.getElementById('poemText');
      const poemInfo = document.getElementById('poemInfo');

      // Remove active class from all buttons
      document.querySelectorAll('.poem-button').forEach(btn => btn.classList.remove('active'));

      // Add active class to clicked button
      const buttons = document.querySelectorAll('.poem-button');
      const buttonIndex = currentPoems.indexOf(poem);
      if (buttons[buttonIndex]) {
        buttons[buttonIndex].classList.add('active');
      }

      poemText.innerHTML = `
        <div class="poem-actions">
          <button class="action-btn" id="favoriteBtn" title="Add to Favorites" onclick="toggleFavorite()">
            <i class="fas fa-heart ${favorites.includes(index) ? 'text-red-500' : ''}"></i>
          </button>
          <button class="action-btn" id="copyBtn" title="Copy Poem" onclick="copyPoem()">
            <i class="fas fa-copy"></i>
          </button>
        </div>
        <h2 style="margin-bottom: 15px; color: #667eea;">${poem.title}</h2>
        <pre>${poem.text}</pre>
      `;

      const analysisFormatted = poem.analysis
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\n/g, '<br>');

      poemInfo.innerHTML = `
        <h3 style="color: #f093fb; margin-bottom: 15px;">Author: ${poem.author}</h3>
        <h4 style="margin-bottom: 10px;">XML Analysis:</h4>
        <div class="xml-analysis">${analysisFormatted}</div>
      `;

      updateFavoritesCount();
    }

    function filterPoems(category) {
      // Remove active class from all filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));

      // Add active class to clicked button
      event.target.classList.add('active');

      if (category === 'all') {
        currentPoems = poems;
      } else {
        currentPoems = poems.filter(poem => poem.category === category);
      }
      renderPoems(currentPoems);
    }

    function searchPoems() {
      const searchTerm = document.getElementById('searchBox').value.toLowerCase();
      const filteredPoems = poems.filter(poem =>
        poem.title.toLowerCase().includes(searchTerm) ||
        poem.author.toLowerCase().includes(searchTerm) ||
        poem.text.toLowerCase().includes(searchTerm)
      );
      renderPoems(filteredPoems);
    }

    function selectRandomPoem() {
      const randomIndex = Math.floor(Math.random() * currentPoems.length);
      const randomPoem = currentPoems[randomIndex];
      displayPoem(randomPoem, poems.indexOf(randomPoem));
    }

    function toggleFavorite() {
      if (currentPoemIndex === -1) return;

      if (favorites.includes(currentPoemIndex)) {
        favorites = favorites.filter(fav => fav !== currentPoemIndex);
        showToast('Removed from favorites');
      } else {
        favorites.push(currentPoemIndex);
        showToast('Added to favorites');
      }

      localStorage.setItem('poetryFavorites', JSON.stringify(favorites));

      // Update favorite button
      const favoriteBtn = document.querySelector('#favoriteBtn i');
      if (favoriteBtn) {
        favoriteBtn.className = `fas fa-heart ${favorites.includes(currentPoemIndex) ? 'text-red-500' : ''}`;
      }

      updateFavoritesCount();
    }

    function copyPoem() {
      if (currentPoemIndex === -1) return;

      const poem = poems[currentPoemIndex];
      const textToCopy = `${poem.title}\nby ${poem.author}\n\n${poem.text}`;

      navigator.clipboard.writeText(textToCopy).then(() => {
        showToast('Poem copied to clipboard');
      });
    }

    function readAloud() {
      if (currentPoemIndex === -1) {
        showToast('Please select a poem first');
        return;
      }

      const poem = poems[currentPoemIndex];
      const textToRead = `${poem.title} by ${poem.author}. ${poem.text}`;

      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        return;
      }

      const utterance = new SpeechSynthesisUtterance(textToRead);
      utterance.rate = 0.8;
      utterance.pitch = 1;
      speechSynthesis.speak(utterance);

      showToast('Reading poem aloud...');
    }

    function sharePoem() {
      if (currentPoemIndex === -1) {
        showToast('Please select a poem first');
        return;
      }

      const poem = poems[currentPoemIndex];
      const shareText = `"${poem.title}" by ${poem.author}\n\n${poem.text}\n\nShared from Poetry Appreciation`;

      if (navigator.share) {
        navigator.share({
          title: poem.title,
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          showToast('Poem copied for sharing');
        });
      }
    }

    function downloadPoem() {
      if (currentPoemIndex === -1) {
        showToast('Please select a poem first');
        return;
      }

      const poem = poems[currentPoemIndex];
      const content = `${poem.title}\nby ${poem.author}\n\n${poem.text}\n\nAnalysis:\n${poem.analysis}`;

      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${poem.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.txt`;
      a.click();
      URL.revokeObjectURL(url);

      showToast('Poem downloaded');
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);

      const button = document.getElementById('toggleModeBtn');
      button.innerHTML = `<i class="fas fa-${isDark ? 'sun' : 'moon'}"></i> ${isDark ? 'Light' : 'Dark'} Mode`;
    }

    function updateFavoritesCount() {
      document.getElementById('favoritesCount').textContent = favorites.length;
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function () {
      // Set dark mode if previously enabled
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        const button = document.getElementById('toggleModeBtn');
        button.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
      }

      renderPoems();
      updateFavoritesCount();
    });